<view class="container rank-container">
  <!-- Tab Bar -->
  <view class="tab-bar">
    <view class="tab-item {{activeTab === 'global' ? 'active' : ''}}" bindtap="switchTab" data-tab="global">
      <text>å…¨æœæ’è¡Œ</text>
    </view>
    <view class="tab-item {{activeTab === 'friends' ? 'active' : ''}}" bindtap="switchTab" data-tab="friends">
      <text>å¥½å‹æ’è¡Œ</text>
    </view>
  </view>

  <!-- Global Tab Content -->
  <view class="tab-content" wx:if="{{activeTab === 'global'}}">
    <!-- Loading -->
    <view class="loading-wrap" wx:if="{{loading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- Leaderboard List -->
    <view class="rank-list" wx:elif="{{topList.length > 0}}">
      <view
        wx:for="{{topList}}"
        wx:key="rank"
        class="rank-item {{item.isMe ? 'is-me' : ''}}"
      >
        <view class="rank-number {{item.rank <= 3 ? 'top-' + item.rank : ''}}">
          <text wx:if="{{item.rank === 1}}">ğŸ¥‡</text>
          <text wx:elif="{{item.rank === 2}}">ğŸ¥ˆ</text>
          <text wx:elif="{{item.rank === 3}}">ğŸ¥‰</text>
          <text wx:else>{{item.rank}}</text>
        </view>
        <view class="rank-avatar">
          <image wx:if="{{item.avatarUrl}}" src="{{item.avatarUrl}}" mode="aspectFill" class="avatar-img" />
          <view wx:else class="avatar-placeholder">
            <text>{{item.nickName[0] || '?'}}</text>
          </view>
        </view>
        <view class="rank-info">
          <text class="rank-name">{{item.nickName}}</text>
          <text class="rank-detail">ç¬¬{{item.highestLevel}}å…³ Â· â­{{item.totalStars}}</text>
        </view>
        <text class="rank-score">{{item.compositeScore}}</text>
      </view>
    </view>

    <!-- Empty State -->
    <view class="empty-state" wx:else>
      <text class="empty-text">æš‚æ— æ’åæ•°æ®</text>
      <text class="empty-hint">å®Œæˆå…³å¡åå³å¯ä¸Šæ¦œ</text>
    </view>

    <!-- My Rank Card (if not in top 50) -->
    <view class="my-rank-card" wx:if="{{myRank && myRank.rank > 50}}">
      <view class="rank-divider">
        <text class="divider-text">Â· Â· Â·</text>
      </view>
      <view class="rank-item is-me">
        <view class="rank-number">
          <text>{{myRank.rank}}</text>
        </view>
        <view class="rank-avatar">
          <view class="avatar-placeholder me">
            <text>æˆ‘</text>
          </view>
        </view>
        <view class="rank-info">
          <text class="rank-name">{{myRank.nickName}}</text>
          <text class="rank-detail">ç¬¬{{myRank.highestLevel}}å…³ Â· â­{{myRank.totalStars}}</text>
        </view>
        <text class="rank-score">{{myRank.compositeScore}}</text>
      </view>
    </view>
  </view>

  <!-- Friends Tab Content -->
  <view class="tab-content friends-tab" wx:if="{{activeTab === 'friends'}}">
    <open-data class="friend-rank-canvas-wrap">
      <canvas type="2d" class="friend-rank-canvas"></canvas>
    </open-data>
  </view>
</view>
